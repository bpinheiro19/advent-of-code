package day4

import (
	"aoc2024/utils"
	"fmt"
)

func createByteArray(filename string) [][]byte {

	input := utils.GetByteListFromFile(filename)

	byteArr := make([][]byte, 0)
	lineArr := make([]byte, 0)

	for _, b := range input {

		if utils.ByteIsNewLine(b) {
			byteArr = append(byteArr, lineArr)
			lineArr = make([]byte, 0)

		} else {
			lineArr = append(lineArr, b)
		}

	}
	byteArr = append(byteArr, lineArr)

	return byteArr
}

func day4Part1(filename string) int {
	result := 0
	byteArr := createByteArray(filename)

	lenI := len(byteArr)
	for i := 0; i < lenI; i++ {
		lenJ := len(byteArr[i])
		for j := 0; j < lenJ; j++ {

			if isX(byteArr[i][j]) {

				for a := -1; a < 2; a++ {
					for b := -1; b < 2; b++ {

						if (utils.InBounds(i+a, j+b, lenI, lenJ) && isM(byteArr[i+a][j+b])) &&
							(utils.InBounds(i+(a*2), j+(b*2), lenI, lenJ) && isA(byteArr[i+(a*2)][j+(b*2)])) &&
							(utils.InBounds(i+(a*3), j+(b*3), lenI, lenJ) && isS(byteArr[i+(a*3)][j+(b*3)])) {
							result++
						}
					}
				}
			}
		}
	}
	return result
}

/*
Possible solutions
M.M M.S S.M S.S
.A. .A. .A. .A.
S.S M.S S.M M.M

-1,-1  -1,1

	0,0

1,-1    1,1
*/

func day4Part2(filename string) int {
	result := 0
	byteArr := createByteArray(filename)

	lenI := len(byteArr)
	for i := 0; i < lenI; i++ {
		lenJ := len(byteArr[i])
		for j := 0; j < lenJ; j++ {

			if isA(byteArr[i][j]) {

				if (utils.InBounds(i-1, j-1, lenI, lenJ) && isM(byteArr[i-1][j-1])) &&
					(utils.InBounds(i-1, j+1, lenI, lenJ) && isM(byteArr[i-1][j+1])) &&
					(utils.InBounds(i+1, j-1, lenI, lenJ) && isS(byteArr[i+1][j-1])) &&
					(utils.InBounds(i+1, j+1, lenI, lenJ) && isS(byteArr[i+1][j+1])) {
					result++
				}

				if (utils.InBounds(i-1, j-1, lenI, lenJ) && isM(byteArr[i-1][j-1])) &&
					(utils.InBounds(i-1, j+1, lenI, lenJ) && isS(byteArr[i-1][j+1])) &&
					(utils.InBounds(i+1, j-1, lenI, lenJ) && isM(byteArr[i+1][j-1])) &&
					(utils.InBounds(i+1, j+1, lenI, lenJ) && isS(byteArr[i+1][j+1])) {
					result++
				}

				if (utils.InBounds(i-1, j-1, lenI, lenJ) && isS(byteArr[i-1][j-1])) &&
					(utils.InBounds(i-1, j+1, lenI, lenJ) && isM(byteArr[i-1][j+1])) &&
					(utils.InBounds(i+1, j-1, lenI, lenJ) && isS(byteArr[i+1][j-1])) &&
					(utils.InBounds(i+1, j+1, lenI, lenJ) && isM(byteArr[i+1][j+1])) {
					result++
				}

				if (utils.InBounds(i-1, j-1, lenI, lenJ) && isS(byteArr[i-1][j-1])) &&
					(utils.InBounds(i-1, j+1, lenI, lenJ) && isS(byteArr[i-1][j+1])) &&
					(utils.InBounds(i+1, j-1, lenI, lenJ) && isM(byteArr[i+1][j-1])) &&
					(utils.InBounds(i+1, j+1, lenI, lenJ) && isM(byteArr[i+1][j+1])) {
					result++
				}
			}
		}
	}
	return result
}

/*
UTF-8 Letters in bytes
X - 0x58
M - 0x4D
A - 0x41
S - 0x53
*/

func isX(b byte) bool {
	return b == 88
}

func isA(b byte) bool {
	return b == 65
}

func isM(b byte) bool {
	return b == 77
}

func isS(b byte) bool {
	return b == 83
}

func Run(filename string) {
	fmt.Println("Day4 Part1 Result:", day4Part1(filename))
	fmt.Println("Day4 Part2 Result:", day4Part2(filename))
}
